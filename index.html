<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <title>Lokasi FC MAKA - Modern</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      /* Warna Tema Terang & Modern */
      --bg-body: #f3f4f6;
      --bg-gradient: linear-gradient(135deg, #f9fafb 0%, #e5e7eb 100%);
      --card-bg: #ffffff;
      --primary: #2563eb; /* Royal Blue */
      --primary-hover: #1d4ed8;
      --accent: #06b6d4; /* Cyan/Teal */
      --text-main: #1f2937; /* Dark Grey */
      --text-sec: #6b7280; /* Light Grey */
      --warn: #f97316; /* Orange */
      --danger: #ef4444; /* Red */
      --shadow-soft: 0 10px 25px -5px rgba(0, 0, 0, 0.05), 0 8px 10px -6px rgba(0, 0, 0, 0.01);
      --radius: 16px;
    }
    
    html { height: 100%; scroll-behavior: smooth; }
    
    body{
      min-height: 100%; 
      margin:0;
      font-family: 'Poppins', sans-serif;
      background: var(--bg-gradient);
      color: var(--text-main);
      -webkit-font-smoothing: antialiased;
      text-align: center;
      padding-bottom: 80px; /* Ruang untuk footer */
    }
    
    /* HEADER */
    header{
      padding: 20px 20px 5px 20px;
      background: rgba(255, 255, 255, 0.8);
      backdrop-filter: blur(10px);
      position: sticky;
      top: 0;
      z-index: 100;
      border-bottom: 1px solid rgba(0,0,0,0.05);
    }
    .logo-container img{
      width: 90px;
      height: auto;
      filter: drop-shadow(0 4px 6px rgba(0,0,0,0.1));
    }
    
    header h1{
      margin: 10px 0;
      color: var(--text-main);
      font-size: 1.4rem;
      font-weight: 800;
      letter-spacing: -0.5px;
      background: -webkit-linear-gradient(45deg, var(--primary), var(--accent));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    /* TOMBOL TEMUKAN */
    .find-btn{
      padding: 12px 24px;
      margin: 5px auto 15px auto;
      display: inline-block;
      background: linear-gradient(90deg, var(--primary) 0%, var(--accent) 100%);
      border: none;
      color: white;
      border-radius: 50px;
      cursor: pointer;
      font-weight: 600;
      font-size: 0.95rem;
      box-shadow: 0 4px 15px rgba(37, 99, 235, 0.3);
      transition: all 0.3s ease;
      min-width: 220px;
    }
    .find-btn:hover{
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(37, 99, 235, 0.4);
    }
    .find-btn.loading, .find-btn:disabled {
      cursor: wait;
      background: var(--text-sec);
      transform: none;
      box-shadow: none;
    }

    /* SEARCH BOX - FIX FULL WIDTH */
    .search-container {
      padding: 10px 20px 20px 20px;
      width: 100%;
      box-sizing: border-box; /* Pastikan padding tidak menambah lebar */
      display: flex;
      justify-content: center;
    }
    #searchBox {
      width: 100%; /* Full Width */
      max-width: 800px; /* Batas maksimal di desktop */
      padding: 14px 20px;
      border: 1px solid #e5e7eb;
      border-radius: var(--radius);
      background: #ffffff;
      color: var(--text-main);
      font-size: 1rem;
      box-shadow: var(--shadow-soft);
      transition: all 0.3s ease;
      text-align: center;
      font-family: inherit;
      box-sizing: border-box; /* Penting agar padding di dalam kotak */
    }
    #searchBox:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 4px rgba(37, 99, 235, 0.1);
    }

    /* LIST CONTAINER */
    main.list-container{
      display: flex;
      flex-direction: column;
      gap: 16px;
      padding: 0 20px 40px 20px;
      max-width: 800px;
      margin: 0 auto;
    }

    /* CARD STYLE */
    .card{
      background: var(--card-bg);
      border-radius: var(--radius);
      box-shadow: var(--shadow-soft);
      text-align: left;
      overflow: hidden;
      border: 1px solid rgba(0,0,0,0.03);
      transition: transform 0.2s ease;
      opacity: 0;
      transform: translateY(20px);
      animation: fadeInUp 0.5s ease forwards;
    }
    @keyframes fadeInUp { to { opacity: 1; transform: translateY(0); } }
    
    .card summary {
      padding: 18px 20px;
      color: var(--text-main);
      font-weight: 700;
      font-size: 1.05rem;
      cursor: pointer;
      list-style: none;
      position: relative;
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: background 0.2s;
    }
    .card summary:hover { background: #f9fafb; }
    .card summary::-webkit-details-marker { display: none; }
    
    /* Ikon Accordion + / - */
    .card summary::after {
      content: '+';
      font-weight: 300; font-size: 1.5rem;
      color: var(--primary);
      background: rgba(37, 99, 235, 0.1);
      width: 30px; height: 30px;
      display: flex; align-items: center; justify-content: center;
      border-radius: 50%;
      transition: transform 0.3s ease;
      flex-shrink: 0; /* Agar tidak gepeng */
    }
    .card[open] summary::after {
      content: '‚àí';
      transform: rotate(180deg);
      background: var(--primary);
      color: white;
    }
    .card-distance {
      font-size: 0.8rem;
      font-weight: 600;
      color: var(--primary);
      background: rgba(37, 99, 235, 0.08);
      padding: 4px 8px;
      border-radius: 8px;
      margin-left: 8px;
      white-space: nowrap;
    }

    .card-content {
      padding: 0 20px 20px 20px;
      border-top: 1px solid #f3f4f6;
    }
    .card-content p{
      margin: 8px 0;
      font-size: 0.9rem;
      color: var(--text-sec);
    }
    
    /* ACTION BUTTONS */
    .card-actions {
      margin-top: 15px;
      display: grid;
      grid-template-columns: 1fr 1fr; 
      gap: 10px; 
    }
    .nav-link {
      grid-column: 1 / -1; /* Full width */
      background: var(--primary);
      color: white !important;
      padding: 12px;
      border-radius: 10px;
      text-align: center;
      font-weight: 600;
      text-decoration: none;
      box-shadow: 0 4px 6px rgba(37, 99, 235, 0.2);
    }
    .report-btn, .cp-btn {
      padding: 10px;
      text-align: center;
      border-radius: 10px;
      font-weight: 600;
      font-size: 0.85rem;
      text-decoration: none;
    }
    .report-btn { background: #fff1f2; color: var(--danger); border: 1px solid #fecdd3; }
    .cp-btn { background: #ecfeff; color: var(--accent); border: 1px solid #cffafe; }
    
    /* HELP BUTTON */
    #helpBtn {
      background: white;
      color: var(--text-main);
      border: 1px solid #e5e7eb;
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 0.85rem;
      font-weight: 600;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 5px;
      position: absolute;
      right: 20px; top: 20px;
    }

    /* SIDEBAR */
    #helpPanel{
      position: fixed; top: 0; right: -340px;
      width: 300px; height: 100%;
      background: rgba(255, 255, 255, 0.98);
      box-shadow: -5px 0 25px rgba(0,0,0,0.1);
      padding: 25px;
      transition: right .36s cubic-bezier(0.2, 0.8, 0.2, 1);
      z-index: 999;
      text-align: left;
    }
    #helpPanel a { 
        display: block; background: #eff6ff; color: var(--primary); 
        padding: 10px; border-radius: 8px; margin-top: 5px;
        text-decoration: none; font-weight: 600;
    }

    /* FOOTER */
    footer{
      position: fixed;
      bottom: 0; left: 0; width: 100%;
      background: white;
      padding: 15px;
      box-shadow: 0 -4px 20px rgba(0,0,0,0.05);
      display: flex;
      flex-direction: column; /* Stack vertical */
      justify-content: center;
      align-items: center;
      z-index: 900;
      border-top: 1px solid #f3f4f6;
      box-sizing: border-box;
    }
    .footer-title { font-weight: 700; color: var(--primary); margin: 0; }
    .footer-subtitle { font-size: 0.75rem; color: var(--text-sec); margin: 0; }
    /* Viewer count dihapus */

    /* WELCOME MODAL */
    #welcomeOverlay{
      position: fixed; inset: 0;
      background: rgba(31, 41, 55, 0.4);
      backdrop-filter: blur(4px);
      display: flex; align-items: center; justify-content: center;
      z-index: 10000;
    }
    #welcomeBox{
      background: white;
      color: var(--text-main);
      border-radius: 24px;
      padding: 30px;
      width: 85%; max-width: 400px;
      text-align: center;
      box-shadow: 0 20px 50px rgba(0,0,0,0.2);
    }
    .welcome-actions { display: flex; flex-direction: column; gap: 10px; margin-top: 20px; }
    .btn-welcome-primary { background: var(--primary); color: white; border: none; padding: 14px; border-radius: 12px; font-weight: 600; font-size: 1rem; }
    .btn-welcome-alt { background: white; color: var(--danger); border: 2px solid #fecdd3; padding: 14px; border-radius: 12px; font-weight: 600; }

    /* TOAST */
    #toastNotification {
      position: fixed; top: 20px; left: 50%;
      transform: translate(-50%, -100px);
      background: var(--text-main); color: white;
      padding: 12px 24px; border-radius: 50px; font-weight: 500; font-size: 0.9rem;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2); z-index: 10001;
      opacity: 0; transition: all 0.4s;
    }
    #toastNotification.show { transform: translate(-50%, 10px); opacity: 1; }

    /* Back to Top */
    #toTopBtn {
        position: fixed; bottom: 90px; right: 20px;
        width: 45px; height: 45px;
        background: white; color: var(--primary);
        border: none; border-radius: 50%;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        font-size: 1.2rem; cursor: pointer; z-index: 950; display: none;
    }

    @media (max-width:600px){
      header h1{ font-size: 1.3rem; }
      .logo-container img{ width: 80px; }
      #helpBtn { position: static; margin: 10px auto; display: table; }
      .card summary { font-size: 0.95rem; padding: 15px; }
      .card-distance { display: block; margin: 4px 0 0 0; width: fit-content; }
      .card-actions { display: flex; flex-direction: column; }
    }
  </style>
</head>
<body>

  <header>
    <div class="logo-container">
      <img src="mlu-logo.png" alt="MLU" id="mluLogo" onerror="this.style.display='none'">
    </div>
    <h1>Lokasi Fast Charging</h1>
    <button class="find-btn" id="manualFindBtn">üìç Temukan Lokasi Terdekat</button>
    <button id="helpBtn">üÜò Bantuan</button>
  </header>
  
  <div class="search-container">
      <input type="text" id="searchBox" placeholder="üîç Cari lokasi, 'Gratis', '24 jam'..." />
  </div>

  <main class="list-container">
    </main>

  <button id="toTopBtn">‚¨ÜÔ∏è</button>

  <footer>
    <div>
      <p class="footer-title">MLU Squad</p>
      <p class="footer-subtitle">Maka Lintas Utara</p>
    </div>
  </footer>

  <div id="helpPanel" aria-hidden="true">
    <h3>Pusat Bantuan</h3>
    <p>Kendala teknis atau butuh towing?</p>
    <div style="margin-top:20px;">
      <a href="https://wa.me/6287722285445?text=Halo%2C%20saya%20butuh%20bantuan%20towing">üîß Hubungi Towing</a>
      <a href="https://wa.me/6285117468556?text=Halo%2C%20saya%20butuh%20info%20tagihan">üí≥ Info Tagihan</a>
      <a href="https://wa.me/6285281760728">üëë Chat Akbar (RTO)</a>
      <a href="https://wa.me/6282310253644">üëë Chat Ilham (Ketum)</a>
    </div>
    <button id="closeHelp" style="margin-top:20px; width:100%; padding:12px; border-radius:10px; border:none; background:#f3f4f6; color:var(--text-sec); font-weight:600; cursor:pointer;">Tutup Panel</button>
  </div>

  <div id="welcomeOverlay" style="display:none;">
    <div id="welcomeBox">
      <h3 style="margin-top:0; color:var(--primary);">Selamat Datang!</h3>
      <p style="color:var(--text-sec);">Apa yang bisa kami bantu?</p>
      <div class="welcome-actions">
        <button class="btn-welcome-primary" id="welcomeFind">üìç Cari Charger Terdekat</button>
        <button class="btn-welcome-alt" id="welcomeSOS">üÜò Butuh Bantuan Darurat</button>
      </div>
    </div>
  </div>

  <div id="toastNotification"></div>

  <script>
    // DATA LOKASI
    const chargers = [
      { name: "Kelapa Gading", lat: -6.171583, lng: 106.899884, link: "https://maps.app.goo.gl/TKfjDuwrEFU2tHoF9", type: "Fast", nozzles: 3, hours: "24 jam 7/7", cost: "Gratis" },
      { name: "Radio Dalam", lat: -6.257621, lng: 106.802051, link: "https://maps.app.goo.gl/VULRCigqJ4iM8SSZ6", type: "Fast", nozzles: 3, hours: "24 jam 7/7", cost: "Gratis" },
      { name: "Bekasi", lat: -6.223919, lng: 106.010150, link: "https://maps.app.goo.gl/4fdRXFebJHJW63Dg7", type: "Fast", nozzles: 3, hours: "24 jam 7/7", cost: "Gratis (Parkir Berbayar)" },
      { name: "Gading Serpong", lat: -6.246792, lng: 106.629594, link: "https://maps.app.goo.gl/j5oeATswU7J9e9jj7", type: "Fast", nozzles: 3, hours: "24 jam 7/7", cost: "Gratis (Parkir Berbayar)" },
      { name: "Depok", lat: -6.402484, lng: 106.794240, link: "https://maps.app.goo.gl/FYH2yXqo1Mgipz6R7", type: "Fast", nozzles: 3, hours: "24 jam 7/7", cost: "Gratis" },
      { name: "Marbella Kemang", lat: -6.260627, lng: 106.813746, link: "https://maps.app.goo.gl/wwzT9iLS34WFRgyi9", type: "Fast", nozzles: 3, hours: "24 jam 7/7", cost: "Gratis (Parkir berbayar)" },
      
      { name: "Starvo PIK", lat: -6.124106, lng: 106.739785, link: "https://maps.app.goo.gl/6c5mKecEKvGqjv3Y7", type: "Medium", nozzles: 2, hours: "Senin‚ÄìJumat 08.00‚Äì19.00", cost: 'Berbayar (via Starvo App)' },
      { name: "Starvo Kedoya", lat: -6.186334, lng: 106.766978, link: "https://maps.app.goo.gl/HSKbMPz5UrwW178V9", type: "Medium", nozzles: 1, hours: "09.00‚Äì17.00", cost: 'Berbayar (via Starvo App)' },
      
      { name: "Ciledug", lat: -6.207012, lng: 106.714569, link: "https://maps.app.goo.gl/DSJiJyAW1BvL2Gwm8", type: "Fast", nozzles: 2, hours: "24 jam 7/7", cost: "Gratis" },
      { name: "Bintaro", lat: -6.276471, lng: 106.730544, link: "https://maps.app.goo.gl/yZNxoj2gyutxd4zJA", type: "Fast", nozzles: 2, hours: "24 jam 7/7", cost: "Gratis" },
      
      { name: "Motoriz Meruya", lat: -6.200132, lng: 106.737796, link: "https://maps.app.goo.gl/xLqKRsEZ9WpBpTjf9", type: "Fast", nozzles: 1, hours: "09.00‚Äì19.00 WIB", cost: "Rp. 5.000 / jam" },
      { name: "Motoriz Kranggan", lat: -6.340640, lng: 106.943016, link: "https://maps.app.goo.gl/bA1248oJ5C8pUXhg9", type: "Fast", nozzles: 2, hours: "09.00‚Äì19.00 WIB", cost: 'Berbayar (via Casan.id)' },
      
      { name: "Warung Bu Ratna Cirendeu", lat: -6.310043, lng: 106.758325, link: "https://maps.app.goo.gl/Eyi3nNZHNMU64iYY7", type: "Fast", nozzles: 2, hours: "06.00‚Äì23.59", cost: "1k per 10%" },
      { name: "Klinik Pratama Condet", lat: -6.273896, lng: 106.857598, link: "https://maps.app.goo.gl/hTwbD4wEKB8g5qnU8?g_st=ac", type: "Fast", nozzles: 2, hours: "07.00 - Malam", cost: 'Berbayar (via Casan.id)' },
      { name: "Mister Kong Steam Wash", lat: -6.350800, lng: 106.830000, link: "https://maps.app.goo.gl/n6nUVbQzWay6f2MG6", type: "Fast", nozzles: 2, hours: "10.00 - 22.00", cost: 'Berbayar (via Casan.id)' },
      
      { name: "Hotel Kartika Chandra", lat: -6.227645, lng: 106.819109, link: "https://maps.app.goo.gl/osYqkiaaebUoauxq5", type: "Fast", nozzles: 5, hours: "24 jam", cost: 'Berbayar (via Starvo App)' },
      { name: "Suzuki Cengkareng", lat: -6.150602, lng: 106.727243, link: "https://maps.app.goo.gl/uy6GpcKEHUtQHoFz7?g_st", type: "Fast", nozzles: 2, hours: "24 jam 7/7", cost: 'Berbayar (via Casan.id)' },
      { name: "Dem Pro Kalimalang", lat: -6.244279, lng: 106.902554, link: "https://maps.app.goo.gl/YaQDCmQ2R5u1d4SP8", type: "Fast", nozzles: 2, hours: "24 jam 7/7", cost: 'Berbayar (via Casan.id)' },
      { name: "Trans go Matraman", lat: -6.208155, lng: 106.874669, link: "https://maps.app.goo.gl/dZD5YVGP7NHFJ8bKA", type: "Fast", nozzles: "2", hours: "24 jam", cost: 'Berbayar (via Casan.id)', cp: "6285697279354" },
      { name: "Motoriz Sukapura", lat: -6.139714, lng: 106.922504, link: "https://maps.app.goo.gl/eePUBDDHDBXboHq4A?g_st=ipc", type: "Fast", nozzles: 2, hours: "24 jam", cost: 'Berbayar (via Casan.id)' },
      { name: "Bengkel Bubut Kemayoran", lat: -6.171770, lang: 106.856194,  link: "https://maps.app.goo.gl/ytu5Szsaq5nZGyFR8", type: "Fast", nozzles: 1, hours: "24 jam 7/7", cost: 'Berbayar (via Casan.id)' },
    ];

    let currentList = [...chargers];
    let toastTimeout;

    function showToast(message) {
      const toast = document.getElementById('toastNotification');
      if (!toast) return;
      toast.textContent = message;
      toast.classList.add('show');
      clearTimeout(toastTimeout);
      toastTimeout = setTimeout(() => {
        toast.classList.remove('show');
      }, 3000);
    }

    function getDistance(lat1, lon1, lat2, lon2) {
      const R = 6371; 
      const dLat = (lat2 - lat1) * Math.PI / 180;
      const dLon = (lon2 - lon1) * Math.PI / 180;
      const a = Math.sin(dLat/2)**2 + Math.cos(lat1*Math.PI/180)*Math.cos(lat2*Math.PI/180)*Math.sin(dLon/2)**2;
      const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
      return R * c;
    }

    function filterCards(query) {
        const lowerQuery = query.toLowerCase().trim();
        const filteredList = chargers.filter(charger => {
            const searchString = `${charger.name} ${charger.type} ${charger.hours} ${charger.cost} ${charger.cp || ''}`.toLowerCase();
            return searchString.includes(lowerQuery);
        });
        currentList = filteredList;
        renderCards(currentList, document.querySelector('.list-container'));
    }

    function renderCards(list, container) {
      if (!container) return; 
      container.innerHTML = '';
      
      if (list.length === 0) {
        container.innerHTML = '<div style="text-align:center; padding:40px; opacity:0.6;"><p>Lokasi tidak ditemukan ü§î</p></div>';
      }
      
      const adminWA = "6287722285445"; 
      
      list.forEach((charger, index) => {
        const card = document.createElement('details');
        card.className = 'card';
        card.style.animationDelay = (index * 50) + 'ms'; 
        const distanceHTML = charger.distance ? `<span class="card-distance">${charger.distance.toFixed(1)} km</span>` : '';
        
        const reportText = `Lapor: Lokasi ${charger.name} bermasalah. (Info dari Web App)`;
        const reportLink = `https://wa.me/${adminWA}?text=${encodeURIComponent(reportText)}`;

        let cpButtonHTML = ''; 
        if (charger.cp) {
          const cpLink = `https://wa.me/${charger.cp}?text=${encodeURIComponent('Halo, info charging station.')}`;
          cpButtonHTML = `<a href="${cpLink}" target="_blank" class="cp-btn" onclick="showToast('Menghubungi CP...')">üìû Hubungi Pemilik</a>`;
        }

        card.innerHTML = `
          <summary>
            <div style="display:flex; align-items:center;">
                <span>${charger.name}</span>
                ${distanceHTML}
            </div>
          </summary>
          <div class="card-content">
            <p>‚ö° <strong>Tipe:</strong> ${charger.type}</p>
            <p>üîå <strong>Slot:</strong> ${charger.nozzles}</p>
            <p>üïí <strong>Jam:</strong> ${charger.hours}</p>
            <p>üíµ <strong>Biaya:</strong> ${charger.cost}</p>
            <div class="card-actions">
              <a href="${charger.link}" target="_blank" class="nav-link">üìç Navigasi Maps</a>
              <a href="${reportLink}" target="_blank" class="report-btn">‚ö†Ô∏è Lapor Rusak</a>
              ${cpButtonHTML}
            </div>
          </div>
        `;
        container.appendChild(card);
      });
    }

    document.addEventListener('DOMContentLoaded', ()=>{
      const listContainer = document.querySelector('.list-container');
      const findBtn = document.getElementById('manualFindBtn');
      const searchBox = document.getElementById('searchBox');
      const helpBtn = document.getElementById('helpBtn');
      const helpPanel = document.getElementById('helpPanel');
      const closeHelp = document.getElementById('closeHelp');
      const welcomeOverlay = document.getElementById('welcomeOverlay');
      const welcomeFind = document.getElementById('welcomeFind');
      const welcomeSOS  = document.getElementById('welcomeSOS');
      const toTopBtn = document.getElementById('toTopBtn');

      function findAndSortCards() {
        if(!navigator.geolocation){
          showToast("‚ö†Ô∏è Browser tidak mendukung lokasi.");
          return;
        }
        findBtn.classList.add('loading');
        findBtn.innerHTML = '‚è≥ Sedang mencari...';
        findBtn.disabled = true;

        navigator.geolocation.getCurrentPosition(pos => {
          const lat = pos.coords.latitude;
          const lng = pos.coords.longitude;

          chargers.forEach(c => {
            c.distance = getDistance(lat, lng, c.lat, c.lng);
          });
          chargers.sort((a, b) => (a.distance || 9999) - (b.distance || 9999));
          currentList = [...chargers]; 
          if (searchBox) searchBox.value = '';
          renderCards(currentList, listContainer); 
          
          findBtn.classList.remove('loading');
          findBtn.innerHTML = '‚úÖ Urut Berdasarkan Jarak';
          
          const firstCard = listContainer.querySelector('.card');
          if (firstCard) {
            setTimeout(() => { 
                firstCard.open = true; 
                window.scrollTo({ top: firstCard.offsetTop - 80, behavior: 'smooth' }); 
            }, 100);
          }
          showToast("Daftar lokasi berhasil diurutkan!");
        }, err => {
          showToast("‚ö†Ô∏è Gagal deteksi lokasi. Pastikan GPS aktif.");
          findBtn.classList.remove('loading');
          findBtn.innerHTML = 'üìç Temukan Lokasi Terdekat';
          findBtn.disabled = false;
        }, {maximumAge:600000, timeout:10000});
      }
      
      function showWelcomeIfFirst(){
        if(!welcomeOverlay) return;
        try {
          if(!localStorage.getItem('mlu_welcome_v2')){
            welcomeOverlay.style.display = 'flex';
          }
        } catch(e){}
      }
      function hideWelcome(){
        if(!welcomeOverlay) return;
        welcomeOverlay.style.display = 'none';
        localStorage.setItem('mlu_welcome_v2','1');
      }

      if(toTopBtn) {
        window.onscroll = () => {
          toTopBtn.style.display = (document.body.scrollTop > 100 || document.documentElement.scrollTop > 100) ? "block" : "none";
        };
        toTopBtn.addEventListener('click', () => window.scrollTo({top: 0, behavior: 'smooth'}));
      }

      if(listContainer) {
        listContainer.addEventListener('click', (e) => {
          if (e.target.tagName === 'SUMMARY') {
            const currentDetail = e.target.closest('details');
            listContainer.querySelectorAll('details').forEach(d => {
              if (d !== currentDetail) d.open = false;
            });
          }
        });
      }
      
      if(searchBox) searchBox.addEventListener('input', (e) => filterCards(e.target.value));
      if(findBtn) findBtn.addEventListener('click', findAndSortCards);

      if(helpBtn && helpPanel) {
        helpBtn.addEventListener('click', ()=> {
            helpPanel.style.right = '0px';
            helpPanel.setAttribute('aria-hidden', 'false');
        });
      }
      if(closeHelp) closeHelp.addEventListener('click', ()=> { 
        helpPanel.style.right = '-340px'; 
        helpPanel.setAttribute('aria-hidden', 'true');
      });

      if(welcomeFind) welcomeFind.addEventListener('click', ()=>{
        hideWelcome();
        findAndSortCards();
      });
      if(welcomeSOS) welcomeSOS.addEventListener('click', ()=>{
        hideWelcome();
        helpPanel.style.right = '0px';
      });

      renderCards(currentList, listContainer);
      showWelcomeIfFirst();
    });
  </script>
</body>
</html>
