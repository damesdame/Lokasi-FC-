<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Lokasi FC MAKA</title>
  <style>
    /* ---------- Basic layout (keep grid design similar to master) ---------- */
    :root{
      --bg1:#0a192f;
      --bg2:#172a45;
      --neon:#64ffda;
      --text:#e6f1ff;
      --card-bg: rgba(10,25,47,0.85);
    }
    html,body{
      height:100%;
      margin:0;
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(180deg,var(--bg1),var(--bg2));
      color:var(--text);
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      text-align:center;
    }
    header{
      padding:18px 16px 8px 16px;
      position:relative;
    }
    .logo-container{
      display:inline-block;
      vertical-align:middle;
    }
    .logo-container svg{
      width:110px;
      height:auto;
      border-radius:0;
      box-shadow: 0 6px 18px rgba(0,0,0,0.5);
    }
    header h1{
      margin:8px 0 12px 0;
      color:var(--neon);
      font-size:1.6rem;
      text-shadow: 0 0 8px rgba(100,255,218,0.18);
      font-weight:700;
    }

    /* manual find button under header */
    .find-btn{
      padding:10px 18px;
      margin:8px auto 12px auto;
      display:inline-block;
      background:transparent;
      border:2px solid var(--neon);
      color:var(--neon);
      border-radius:12px;
      cursor:pointer;
      font-weight:600;
      box-shadow: 0 0 12px rgba(100,255,218,0.25);
      transition:all .2s ease;
      min-width: 220px; /* give space for loading text */
    }
    .find-btn:hover{
      background:var(--neon);
      color:var(--bg1);
      box-shadow: 0 0 26px rgba(100,255,218,0.7);
    }
    .find-btn.loading, .find-btn:disabled {
      cursor: not-allowed;
      background: var(--bg2);
      color: var(--text);
      opacity: 0.7;
      box-shadow: none;
    }

    /* grid */
    main.grid-container{
      display:grid;
      grid-template-columns: repeat(auto-fit, minmax(260px,1fr));
      gap:14px;
      padding:18px;
      max-width:1200px;
      margin:0 auto 110px auto; /* give space for fixed footer */
    }

    .card{
      background: var(--card-bg);
      border: 1px solid rgba(100,255,218,0.12);
      border-radius:12px;
      padding:12px;
      box-shadow: 0 0 12px rgba(100,255,218,0.08);
      transition: transform .15s ease, box-shadow .15s ease;
      text-align:left;
      min-height:120px;
      /* Animation styles */
      opacity: 0;
      transform: translateY(15px);
      animation: fadeIn 0.4s ease-out forwards;
    }
    /* Staggered animation handled by JS */
    @keyframes fadeIn {
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    .card:hover{
      transform: translateY(-6px);
      box-shadow: 0 0 26px rgba(100,255,218,0.12);
    }
    /* -------- smaller fonts to show more items without scroll ----- */
    .card h2{
      color:var(--neon);
      font-size:1.0rem; /* smaller */
      margin:0 0 6px 0;
      line-height:1.1;
      font-weight:700;
    }
    .card p{
      margin:4px 0;
      font-size:0.82rem; /* smaller */
      color:var(--text);
      line-height:1.1;
    }
    /* Style for links inside <p> */
    .card p a {
      color: var(--neon);
      text-decoration: underline;
      font-weight: 600;
    }
    
    /* NEW: Style for distance */
    .card-distance {
      font-size: 1.05rem;
      font-weight: 700;
      color: var(--neon);
      margin: 8px 0 0 0 !important;
      text-shadow: 0 0 8px rgba(100,255,218,0.3);
    }
    
    .card a.nav-link{
      display:inline-block;
      margin-top:8px;
      padding:6px 10px;
      background:var(--neon);
      color:var(--bg1);
      font-weight:700;
      text-decoration:none;
      border-radius:8px;
      font-size:0.82rem;
    }

    /* footer fixed */
    footer{
      position:fixed;
      bottom:0;
      left:0;
      width:100%;
      background: rgba(10,25,47,0.98);
      padding:10px 12px;
      box-shadow: 0 -4px 18px rgba(0,0,0,0.6);
      display:flex;
      align-items:center;
      justify-content:center;
      gap:20px;
      z-index:900;
    }
    .footer-title{
      font-size:1.1rem;
      color:var(--neon);
      font-weight:700;
      margin:0;
      letter-spacing: 6px;
    }
    .footer-subtitle{
      font-size:0.75rem;
      color:#ccd6f6;
      margin:0;
      opacity:0.9;
    }
    #viewerCount{
      color:var(--neon);
      font-weight:700;
      font-size:0.95rem;
      text-shadow: 0 0 6px rgba(100,255,218,0.16);
    }

    /* help button near logo (SOS) */
    #helpBtn {
      position:absolute;
      top:14px;
      right:18px;
      background:var(--neon);
      color:var(--bg1);
      border:none;
      border-radius:22px;
      padding:8px 12px;
      font-weight:700;
      cursor:pointer;
      box-shadow: 0 0 16px rgba(100,255,218,0.5);
      z-index:800;
    }
    @media (max-width:600px){
      #helpBtn{
        position:static;
        display:block;
        margin:8px auto 0 auto;
      }
      header h1{font-size:1.2rem;}
      .logo-container svg{width:88px;}
      main.grid-container{padding:12px; gap:10px;}
    }

    /* help panel */
    #helpPanel{
      position:fixed;
      top:0;
      right:-320px;
      width:300px;
      height:100%;
      background: rgba(10,25,47,0.97);
      box-shadow: -2px 0 18px rgba(100,255,218,0.28);
      border-left:1px solid rgba(100,255,218,0.12);
      color:var(--text);
      padding:18px;
      transition:right .36s ease;
      z-index:980;
      overflow:auto;
      font-size:0.9rem;
    }

    /* REMOVED: .result-popup styles (no longer needed) */

    /* initial welcome modal (shows once) */
    #welcomeOverlay{
      position:fixed;
      inset:0;
      background: rgba(0,0,0,0.55);
      display:flex;
      align-items:center;
      justify-content:center;
      z-index:10000;
    }
    #welcomeBox{
      background: rgba(10,25,47,0.98);
      color:var(--text);
      border-radius:12px;
      padding:18px;
      border:1px solid rgba(100,255,218,0.14);
      min-width:280px;
      text-align:center;
      box-shadow: 0 12px 40px rgba(0,0,0,0.6);
    }
    #welcomeBox h3{
      margin:6px 0 10px 0;
      color:var(--neon);
      font-size:1.1rem;
    }
    #welcomeBox p{margin:0 0 10px 0; font-size:0.95rem;}
    .welcome-actions{display:flex; gap:8px; justify-content:center; margin-top:10px; flex-wrap:wrap;}
    .welcome-actions button{
      padding:8px 12px;
      border-radius:8px;
      border:none;
      cursor:pointer;
      font-weight:700;
    }
    .btn-welcome-primary{ background:var(--neon); color:var(--bg1); }
    .btn-welcome-alt{ background:transparent; color:var(--neon); border:1px solid rgba(100,255,218,0.18); }
  </style>
</head>
<body>

  <header>
    <div class="logo-container">
      <svg id="mluLogo" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
        <defs>
          <linearGradient id="neonGrad" x1="0%" y1="0%" x2="100%" y2="100%">
            <stop offset="0%" style="stop-color:var(--neon); stop-opacity:1" />
            <stop offset="100%" style="stop-color:#ffffff; stop-opacity:0.8" />
          </linearGradient>
          <filter id="neonGlow" x="-50%" y="-50%" width="200%" height="200%">
            <feGaussianBlur stdDeviation="3.5" result="coloredBlur"/>
            <feMerge>
              <feMergeNode in="coloredBlur"/>
              <feMergeNode in="SourceGraphic"/>
            </feMerge>
          </filter>
        </defs>
        <rect width="100" height="100" fill="var(--bg2)" rx="15"/>
        <text x="50%" y="60%" dominant-baseline="middle" text-anchor="middle" 
              fill="url(#neonGrad)" font-size="38" font-family="'Poppins', sans-serif" 
              font-weight="700" filter="url(#neonGlow)" letter-spacing="2">MLU</text>
      </svg>
    </div>

    <h1>Lokasi FC MAKA</h1>

    <button class="find-btn" id="manualFindBtn">üìç Temukan Charger Terdekat</button>

    <button id="helpBtn" aria-label="Bantuan">üÜò Bantuan</button>
  </header>

  <main class="grid-container">
    </main>

  <footer>
    <div>
      <p class="footer-title">M L U</p>
      <p class="footer-subtitle">Mau Ape Lu</p>
    </div>
    <div id="viewerCount"><span id="count">‚Äî</span> viewers</div>
  </footer>

  <div id="helpPanel" aria-hidden="true">
    <h3 style="color:var(--neon); margin-top:0; text-shadow:0 0 8px rgba(100,255,218,0.12);">Menu bantuan </h3>
    <p>Motor mati, butuh towing atau tanya soal tagihan xendit?</p>
    <p>Klik salah satu nomor di bawah ini untuk menghubungi via WhatsApp üëá</p>

    <div style="text-align:left; margin-top:12px; font-size:0.92rem;">
      <p>üèçÔ∏è <strong>Kendala Unit</strong><br>
        <a href="https://wa.me/6287722285445?text=Halo%2C%20saya%20butuh%20bantuan%20towing" target="_blank" style="color:var(--neon); text-decoration:none;">+62-877-2228-5445</a>
      </p>
      <p>üìû <strong>Info Tagihan</strong><br>
        <a href="https://wa.me/6285117468556?text=Halo%2C%20saya%20butuh%20informasi%20tentang%20tagihan" target="_blank" style="color:var(--neon); text-decoration:none;">+62 851-1746-8556</a>
      </p>
      <p>üìû <strong>RTO Akbar</strong><br>
        <a href="https://wa.me/6285281760728?text=Halo%2C%20saya%20butuh%20informasi%20tentang%20Maka" target="_blank" style="color:var(--neon); text-decoration:none;">+62 852-8176-0728</a>
      </p>
      <p>üìû <strong>Ketum MLU Ilham</strong><br>
        <a href="https://wa.me/6282310253644?text=Bang%2C%20saya%20butuh%20bantuan" target="_blank" style="color:var(--neon); text-decoration:none;">+62 823-1025-3644</a>
      </p>
    </div>

    <button id="closeHelp" style="margin-top:18px; width:100%; padding:8px; border-radius:8px; border:1px solid rgba(100,255,218,0.12); background:transparent; color:var(--neon); font-weight:700; cursor:pointer;">Tutup</button>
  </div>

  <div id="welcomeOverlay" style="display:none;">
    <div id="welcomeBox" role="dialog" aria-modal="true" aria-label="Selamat datang">
      <h3>Mau Ape Lu ?</h3>
      <p>Pilih satu:</p>
      <div class="welcome-actions">
        <button class="btn-welcome-primary" id="welcomeFind">üìç cari lokasi fc terdekat</button>
        <button class="btn-welcome-alt" id="welcomeSOS">üÜò Perlu Bantuan / SOS</button>
      </div>
    </div>
  </div>

  <script>
    // ==========================================================
    // Data lokasi (SUMBER DATA TUNGGAL - SEMUA DATA DISINI)
    // ==========================================================
    const chargers = [
      { name: "MAKA Showroom Kelapa Gading", lat: -6.159635, lng: 106.906682, link: "https://maps.app.goo.gl/TKfjDuwrEFU2tHoF9", type: "Fast", nozzles: 3, hours: "24 jam 7/7", cost: "Gratis" },
      { name: "MAKA Showroom Radio Dalam", lat: -6.257621, lng: 106.802051, link: "https://maps.app.goo.gl/VULRCigqJ4iM8SSZ6", type: "Fast", nozzles: 3, hours: "24 jam 7/7", cost: "Gratis" },
      { name: "MAKA Showroom Bekasi", lat: -6.243967, lng: 106.994823, link: "https://maps.app.goo.gl/4fdRXFebJHJW63Dg7", type: "Fast", nozzles: 3, hours: "24 jam 7/7", cost: "Gratis" },
      { name: "MAKA Showroom Gading Serpong", lat: -6.246792, lng: 106.629594, link: "https://maps.app.goo.gl/j5oeATswU7J9e9jj7", type: "Fast", nozzles: 3, hours: "24 jam 7/7", cost: "Gratis (Parkir Berbayar)" },
      { name: "MAKA Showroom Depok", lat: -6.402484, lng: 106.794240, link: "https://maps.app.goo.gl/FYH2yXqo1Mgipz6R7", type: "Fast", nozzles: 3, hours: "24 jam 7/7", cost: "Gratis" },
      { name: "MAKA Hotel Marbella Kemang Residence", lat: -6.260627, lng: 106.813746, link: "https://maps.app.goo.gl/2dEoMaxPMdvA5e356", type: "Fast", nozzles: 3, hours: "24 jam 7/7", cost: "Gratis (Parkir berbayar)" },
      { name: "Starvo PIK", lat: -6.111097, lng: 106.742471, link: "https://maps.app.goo.gl/6c5mKecEKvGqjv3Y7", type: "Medium", nozzles: 2, hours: "Senin‚ÄìJumat 08.00‚Äì19.00; Sabtu 08.00‚Äì17.00", cost: 'Berbayar (via <a href="https://play.google.com/store/apps/details?id=com.moizasia.starvo_mobile" target="_blank">Starvo App</a>)' },
      { name: "Starvo Kedoya", lat: -6.186334, lng: 106.766978, link: "https://maps.app.goo.gl/HSKbMPz5UrwW178V9", type: "Medium", nozzles: 1, hours: "Senin‚ÄìJumat 09.00‚Äì17.00; Sabtu 09.00‚Äì14.00", cost: 'Berbayar (via <a href="https://starvo.co.id/" target="_blank">Starvo App</a>)' },
      { name: "Lite Showroom MAKA Motors Ciledug", lat: -6.237947, lng: 106.708237, link: "https://maps.app.goo.gl/DSJiJyAW1BvL2Gwm8", type: "Fast", nozzles: 2, hours: "24 jam 7/7", cost: "Gratis" },
      { name: "Lite Showroom MAKA Motors Bintaro", lat: -6.276471, lng: 106.730544, link: "https://maps.app.goo.gl/yZNxoj2gyutxd4zJA", type: "Fast", nozzles: 2, hours: "24 jam 7/7", cost: "Gratis" },
      { name: "Motoriz Meruya", lat: -6.200132, lng: 106.737796, link: "https://maps.app.goo.gl/nV69aPbcA1MWjLnN7", type: "Medium", nozzles: 1, hours: "09.00‚Äì19.00 WIB", cost: "Rp. 5.000 / jam" },
      { name: "Motoriz Kranggan", lat: -6.340640, lng: 106.943016, link: "https://maps.app.goo.gl/bA1248oJ5C8pUXhg9", type: "Fast", nozzles: 2, hours: "09.00‚Äì19.00 WIB", cost: 'Berbayar (via <a href="https://casan.id/" target="_blank">Casan.id</a>)' },
      { name: "Warung Bu Ratna Cirendeu", lat: -6.310043, lng: 106.758325, link: "https://maps.app.goo.gl/7cK7Vr1qtS7YzpSH7", type: "Fast", nozzles: 2, hours: "06.00‚Äì23.59", cost: "1k per 10%" },
      { name: "Klinik Pratama Condet", lat: -6.295322, lng: 106.863682, link: "https://maps.app.goo.gl/417yrRuVMJNmEtf17", type: "Fast", nozzles: 2, hours: "07.00 - Sampe tukang martabak pulang", cost: 'Berbayar (via <a href="https://casan.id/" target="_blank">Casan.id</a>)' },
      { name: "Mister Kong Steam Wash Srengseng Sawah Jagakarsa", lat: -6.299000, lng: 106.800000, link: "https://share.google/nj9RIQjsBEMEvPcGK", type: "Fast", nozzles: 2, hours: "10.00 - 22.00", cost: 'Berbayar (via <a href="https://casan.id/" target="_blank">Casan.id</a>)' },
      { name: "Hotel Kartika Chandra", lat: -6.260000, lng: 106.840000, link: "https://maps.app.goo.gl/Ca21HTW4uGDgoqWp8?g_st=ac", type: "Fast", nozzles: 5, hours: "24 jam", cost: 'Berbayar (via <a href="https://play.google.com/store/apps/details?id=com.moizasia.starvo_mobile" target="_blank">Starvo App</a>)' }
    ];

    // ---------------------------
    // Elemen Global
    // ---------------------------
    const gridContainer = document.querySelector('.grid-container');
    const findBtn = document.getElementById('manualFindBtn');
    
    // ---------------------------
    // Utility: hitung jarak (km)
    // ---------------------------
    function getDistance(lat1, lon1, lat2, lon2) {
      const R = 6371; // km
      const dLat = (lat2 - lat1) * Math.PI / 180;
      const dLon = (lon2 - lon1) * Math.PI / 180;
      const a = Math.sin(dLat/2)**2 + Math.cos(lat1*Math.PI/180)*Math.cos(lat2*Math.PI/180)*Math.sin(dLon/2)**2;
      const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
      return R * c;
    }

    // ---------------------------
    // NEW: Render Cards function
    // ---------------------------
    function renderCards(list) {
      gridContainer.innerHTML = ''; // Kosongkan grid
      list.forEach((charger, index) => {
        const card = document.createElement('div');
        card.className = 'card';
        
        // Terapkan animasi staggered (muncul satu per satu)
        card.style.animationDelay = (index * 50) + 'ms'; 
        
        // Cek apakah ada data jarak, jika ya, tampilkan
        const distanceHTML = charger.distance ? `<p class="card-distance">üìç Jarak: ${charger.distance.toFixed(1)} km</p>` : '';
        
        card.innerHTML = `
          <h2>‚ö° ${charger.name}</h2>
          <p>üîå Tipe Charger: ${charger.type}</p>
          <p>üîã Jumlah Nozzle: ${charger.nozzles}</p>
          <p>‚è∞ Operasional: ${charger.hours}</p>
          <p>üí∞ Biaya: ${charger.cost}</p>
          ${distanceHTML}
          <a href="${charger.link}" target="_blank" class="nav-link">üìç Buka Navigasi</a>
        `;
        gridContainer.appendChild(card);
      });
    }

    // ---------------------------
    // NEW: Find and Sort Logic
    // ---------------------------
    function findAndSortCards() {
      if(!navigator.geolocation){
        alert("‚ö†Ô∏è Browser tidak mendukung deteksi lokasi.");
        return;
      }

      // Tampilkan status loading di tombol
      findBtn.classList.add('loading');
      findBtn.textContent = 'Mencari Lokasi...';
      findBtn.disabled = true;

      navigator.geolocation.getCurrentPosition(pos => {
        const lat = pos.coords.latitude;
        const lng = pos.coords.longitude;

        // 1. Hitung jarak untuk setiap charger dan tambahkan ke objek
        chargers.forEach(c => {
          c.distance = getDistance(lat, lng, c.lat, c.lng);
        });

        // 2. Urutkan array chargers berdasarkan properti 'distance'
        chargers.sort((a, b) => a.distance - b.distance);

        // 3. Render ulang semua kartu dengan data yang sudah terurut
        renderCards(chargers);
        
        // 4. Update status tombol
        findBtn.classList.remove('loading');
        findBtn.textContent = '‚úÖ Lokasi Diurutkan';
        findBtn.disabled = true; // Nonaktifkan setelah sukses

        // 5. Scroll ke atas untuk melihat hasil teratas
        window.scrollTo({ top: 0, behavior: 'smooth' });

      }, err => {
        alert("‚ö†Ô∏è Gagal mendeteksi lokasi. Pastikan izin lokasi aktif.");
        findBtn.classList.remove('loading');
        findBtn.textContent = 'üìç Temukan Charger Terdekat';
        findBtn.disabled = false;
      }, {maximumAge:600000, timeout:10000});
    }

    // attach manual button
    findBtn.addEventListener('click', findAndSortCards);


    // ---------------------------
    // Help panel toggles (Tidak berubah)
    // ---------------------------
    const helpBtn = document.getElementById('helpBtn');
    const helpPanel = document.getElementById('helpPanel');
    const closeHelp = document.getElementById('closeHelp');

    helpBtn.addEventListener('click', ()=>{
      helpPanel.style.right = helpPanel.style.right === '0px' ? '-320px' : '0px';
      helpPanel.setAttribute('aria-hidden', helpPanel.style.right === '0px');
    });
    closeHelp.addEventListener('click', ()=> { 
      helpPanel.style.right = '-320px'; 
      helpPanel.setAttribute('aria-hidden', 'true');
    });

    // ---------------------------
    // Welcome overlay (show once)
    // ---------------------------
    const welcomeOverlay = document.getElementById('welcomeOverlay');
    const welcomeFind = document.getElementById('welcomeFind');
    const welcomeSOS  = document.getElementById('welcomeSOS');

    function showWelcomeIfFirst(){
      try {
        const shown = localStorage.getItem('mlu_welcome_shown_v1');
        if(!shown){
          welcomeOverlay.style.display = 'flex';
        }
      } catch(e){ /* ignore storage errors */ }
    }
    function hideWelcome(){
      welcomeOverlay.style.display = 'none';
      try { localStorage.setItem('mlu_welcome_shown_v1','1'); } catch(e){}
    }
    // attach actions
    welcomeFind.addEventListener('click', ()=>{
      hideWelcome();
      // trigger find and sort
      findAndSortCards();
    });
    welcomeSOS.addEventListener('click', ()=>{
      hideWelcome();
      // open help panel
      helpPanel.style.right = '0px';
      helpPanel.setAttribute('aria-hidden', 'false');
    });

    // ---------------------------
    // Visitor counter (Tidak berubah)
    // ---------------------------
    const countEl = document.getElementById('count');
    async function updateVisitCounter(){
      const namespace = 'mlu-charger';
      const key = 'visits';
      try {
        const res = await fetch(`https://api.countapi.xyz/hit/${encodeURIComponent(namespace)}/${encodeURIComponent(key)}`);
        if(!res.ok) throw new Error('countapi error');
        const data = await res.json();
        if(data && typeof data.value !== 'undefined'){
          countEl.textContent = data.value.toLocaleString();
          return;
        }
      } catch(err){ }
      try {
        const localKey = 'mlu_visits_fallback_v1';
        let val = parseInt(localStorage.getItem(localKey) || '0', 10);
        val = isNaN(val) ? 1 : val + 1;
        localStorage.setItem(localKey, val);
        countEl.textContent = val.toLocaleString();
      } catch(e){
        countEl.textContent = '‚Äî';
      }
    }
    updateVisitCounter();

    // ---------------------------
    // Global Event Listeners
    // ---------------------------

    // Close on Esc
    document.addEventListener('keydown', e=>{
      if(e.key === 'Escape'){
        if(welcomeOverlay.style.display === 'flex'){ hideWelcome(); }
        if(helpPanel.style.right === '0px'){ 
          helpPanel.style.right = '-320px'; 
          helpPanel.setAttribute('aria-hidden', 'true');
        }
      }
    });

    // ---------------------------
    // Initial Page Load
    // ---------------------------
    document.addEventListener('DOMContentLoaded', ()=>{
      // Render kartu awal (urutan default)
      renderCards(chargers);
      
      // Tampilkan welcome jika ini kunjungan pertama
      showWelcomeIfFirst();
      
      // (Fungsi adjustHelpPos dihapus karena CSS @media sudah menanganinya dgn baik)
    });

  </script>
</body>
</html>
