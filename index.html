<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <title>Lokasi FC MAKA - Modern</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      /* Warna Tema */
      --bg-gradient: linear-gradient(135deg, #f9fafb 0%, #e5e7eb 100%);
      --card-bg: #ffffff;
      --primary: #2563eb; 
      --accent: #06b6d4; 
      --text-main: #1f2937; 
      --text-sec: #6b7280; 
      --danger: #ef4444; /* Merah untuk SOS */
      --radius: 16px;
      --shadow-soft: 0 10px 25px -5px rgba(0, 0, 0, 0.05);
    }
    
    html { height: 100%; scroll-behavior: smooth; }
    
    body{
      min-height: 100%; 
      margin:0;
      font-family: 'Poppins', sans-serif;
      background: var(--bg-gradient);
      color: var(--text-main);
      -webkit-font-smoothing: antialiased;
      text-align: center;
      padding-bottom: 100px; /* Ruang ekstra agar konten paling bawah tidak tertutup footer/tombol */
    }
    
    /* HEADER - TIDAK STICKY LAGI (Ikut Scroll) */
    header{
      padding: 20px 20px 5px 20px;
      background: rgba(255, 255, 255, 0.5);
      /* position: sticky;  <-- DIHAPUS agar ikut scroll */
      position: relative; 
      border-bottom: 1px solid rgba(0,0,0,0.05);
    }
    
    .logo-container img{
      width: 90px;
      height: auto;
      filter: drop-shadow(0 4px 6px rgba(0,0,0,0.1));
    }
    
    header h1{
      margin: 10px 0;
      font-size: 1.4rem;
      font-weight: 800;
      background: -webkit-linear-gradient(45deg, var(--primary), var(--accent));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    /* Tombol Bantuan di Header (Hanya muncul saat di atas) */
    #helpBtnHeader {
      background: white;
      color: var(--text-main);
      border: 1px solid #e5e7eb;
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 0.85rem;
      font-weight: 600;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 5px;
      position: absolute;
      right: 20px; top: 20px;
    }

    /* TOMBOL TEMUKAN */
    .find-btn{
      padding: 12px 24px;
      margin: 5px auto 15px auto;
      display: inline-block;
      background: linear-gradient(90deg, var(--primary) 0%, var(--accent) 100%);
      border: none;
      color: white;
      border-radius: 50px;
      cursor: pointer;
      font-weight: 600;
      font-size: 0.95rem;
      box-shadow: 0 4px 15px rgba(37, 99, 235, 0.3);
      transition: transform 0.2s;
      min-width: 220px;
    }
    .find-btn:active{ transform: scale(0.98); }

    /* SEARCH BOX FULL WIDTH */
    .search-container {
      padding: 10px 20px 20px 20px;
      display: flex; justify-content: center;
    }
    #searchBox {
      width: 100%; max-width: 800px;
      padding: 14px 20px;
      border: 1px solid #e5e7eb;
      border-radius: var(--radius);
      font-size: 1rem;
      box-shadow: var(--shadow-soft);
      text-align: center;
      outline: none;
      transition: border 0.3s;
    }
    #searchBox:focus { border-color: var(--primary); }

    /* LIST CONTAINER */
    main.list-container{
      display: flex; flex-direction: column; gap: 16px;
      padding: 0 20px 20px 20px;
      max-width: 800px; margin: 0 auto;
    }

    /* KARTU LOKASI */
    .card{
      background: var(--card-bg);
      border-radius: var(--radius);
      box-shadow: var(--shadow-soft);
      text-align: left;
      border: 1px solid rgba(0,0,0,0.03);
      opacity: 0; animation: fadeInUp 0.5s ease forwards;
    }
    @keyframes fadeInUp { to { opacity: 1; transform: translateY(0); } }
    
    .card summary {
      padding: 18px 20px;
      font-weight: 700;
      font-size: 1.05rem;
      cursor: pointer;
      list-style: none;
      display: flex; justify-content: space-between; align-items: center;
    }
    .card summary::-webkit-details-marker { display: none; }
    .card summary::after {
      content: '+'; color: var(--primary);
      background: rgba(37, 99, 235, 0.1);
      width: 30px; height: 30px; border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      transition: transform 0.3s;
    }
    .card[open] summary::after { content: 'âˆ’'; transform: rotate(180deg); background: var(--primary); color: white; }
    
    .card-distance {
      font-size: 0.8rem; color: var(--primary);
      background: rgba(37, 99, 235, 0.08);
      padding: 4px 8px; border-radius: 8px; margin-left: 8px;
    }
    .card-content { padding: 0 20px 20px 20px; border-top: 1px solid #f3f4f6; }
    .card-content p { margin: 8px 0; font-size: 0.9rem; color: var(--text-sec); }
    
    .card-actions { margin-top: 15px; display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
    .nav-link { grid-column: 1 / -1; background: var(--primary); color: white; padding: 12px; border-radius: 10px; text-align: center; text-decoration: none; font-weight: 600; }
    .report-btn { background: #fff1f2; color: var(--danger); border: 1px solid #fecdd3; padding: 10px; border-radius: 10px; text-align: center; text-decoration: none; font-weight: 600; font-size: 0.85rem;}
    .cp-btn { background: #ecfeff; color: var(--accent); border: 1px solid #cffafe; padding: 10px; border-radius: 10px; text-align: center; text-decoration: none; font-weight: 600; font-size: 0.85rem;}

    /* TOMBOL LAMPU MERAH (FLOATING SOS) */
    #floatingSosBtn {
      position: fixed;
      bottom: 100px; /* Posisi di atas footer */
      right: 20px;
      width: 55px; height: 55px;
      background: var(--danger);
      color: white;
      border: none;
      border-radius: 50%;
      font-size: 1.8rem;
      box-shadow: 0 0 15px rgba(239, 68, 68, 0.6);
      z-index: 950;
      display: flex; align-items: center; justify-content: center;
      cursor: pointer;
      /* Awalnya hidden (muncul saat scroll) */
      opacity: 0; pointer-events: none; transform: scale(0.5);
      transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      animation: pulse-red 2s infinite;
    }
    #floatingSosBtn.show {
      opacity: 1; pointer-events: auto; transform: scale(1);
    }
    @keyframes pulse-red {
      0% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); }
      70% { box-shadow: 0 0 0 15px rgba(239, 68, 68, 0); }
      100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); }
    }

    /* TOMBOL BACK TO TOP (Kecil di bawah SOS) */
    #toTopBtn {
      position: fixed; bottom: 40px; right: 25px;
      width: 40px; height: 40px;
      background: white; color: var(--primary);
      border: 1px solid #e5e7eb; border-radius: 50%;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
      font-size: 1.2rem; cursor: pointer; z-index: 940; 
      display: none; /* Dikontrol JS */
    }

    /* FOOTER FIXED */
    footer{
      position: fixed; bottom: 0; left: 0; width: 100%;
      background: white; padding: 10px;
      box-shadow: 0 -4px 20px rgba(0,0,0,0.05);
      display: flex; justify-content: center; z-index: 900;
      border-top: 1px solid #f3f4f6;
    }
    .footer-title { font-weight: 700; color: var(--primary); margin: 0; font-size: 0.9rem; }
    .footer-subtitle { font-size: 0.7rem; color: var(--text-sec); margin: 0; }

    /* PANEL BANTUAN */
    #helpPanel{
      position: fixed; top: 0; right: -340px;
      width: 280px; height: 100%;
      background: rgba(255, 255, 255, 0.98);
      box-shadow: -5px 0 30px rgba(0,0,0,0.15);
      padding: 25px;
      transition: right 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      z-index: 1000; text-align: left;
    }
    #helpPanel a { 
        display: block; background: #eff6ff; color: var(--primary); 
        padding: 12px; border-radius: 12px; margin-top: 8px;
        text-decoration: none; font-weight: 600; font-size: 0.9rem;
    }

    /* MODAL WELCOME */
    #welcomeOverlay{
      position: fixed; inset: 0; background: rgba(0,0,0,0.5);
      backdrop-filter: blur(3px); display: flex; align-items: center; justify-content: center; z-index: 2000;
    }
    #welcomeBox{
      background: white; padding: 30px; border-radius: 24px;
      width: 85%; max-width: 350px; text-align: center;
    }
    .btn-welcome-primary { background: var(--primary); color: white; border: none; padding: 12px; border-radius: 10px; width: 100%; margin-top: 10px; font-weight: 600; }
    .btn-welcome-alt { background: transparent; color: var(--danger); border: 2px solid #fecdd3; padding: 12px; border-radius: 10px; width: 100%; margin-top: 8px; font-weight: 600; }

    /* TOAST */
    #toastNotification {
      position: fixed; top: 20px; left: 50%; transform: translate(-50%, -100px);
      background: #333; color: white; padding: 12px 24px; border-radius: 50px;
      font-size: 0.9rem; z-index: 3000; opacity: 0; transition: all 0.4s;
    }
    #toastNotification.show { transform: translate(-50%, 10px); opacity: 1; }

  </style>
</head>
<body>

  <header>
    <div class="logo-container">
      <img src="mlu-logo.png" alt="MLU" id="mluLogo" onerror="this.style.display='none'">
    </div>
    <h1>Lokasi Fast Charging</h1>
    <button id="helpBtnHeader">ğŸ†˜ Bantuan</button>

    <button class="find-btn" id="manualFindBtn">ğŸ“ Temukan Lokasi Terdekat</button>
  </header>
  
  <div class="search-container">
      <input type="text" id="searchBox" placeholder="ğŸ” Cari lokasi, 'Gratis', '24 jam'..." />
  </div>

  <main class="list-container">
    </main>

  <button id="floatingSosBtn" title="Bantuan Darurat">ğŸ†˜</button>
  
  <button id="toTopBtn">â¬†ï¸</button>

  <footer>
    <div>
      <p class="footer-title">MLU Squad Â© 2025</p>
      <p class="footer-subtitle">Maka Lintas Utara</p>
    </div>
  </footer>

  <div id="helpPanel" aria-hidden="true">
    <h3 style="margin-top:0; border-bottom:1px solid #eee; padding-bottom:10px;">Pusat Bantuan</h3>
    <div style="margin-top:15px;">
      <a href="https://wa.me/6287722285445?text=Halo%2C%20bantuan%20towing">ğŸ”§ Towing / Kendala Unit</a>
      <a href="https://wa.me/6285117468556?text=Halo%2C%20info%20tagihan">ğŸ’³ Admin Tagihan / Xendit</a>
      <a href="https://wa.me/6285281760728">ğŸ‘‘ Chat Akbar (RTO)</a>
      <a href="https://wa.me/6282310253644">ğŸ‘‘ Chat Ilham (Ketum)</a>
    </div>
    <button id="closeHelp" style="margin-top:20px; width:100%; padding:12px; border:none; background:#f3f4f6; color:#666; border-radius:10px; font-weight:600;">Tutup Panel</button>
  </div>

  <div id="welcomeOverlay" style="display:none;">
    <div id="welcomeBox">
      <h3 style="margin-top:0;">Selamat Datang!</h3>
      <p style="color:#666;">Mau cari apa hari ini?</p>
      <button class="btn-welcome-primary" id="welcomeFind">ğŸ“ Cari Charger Terdekat</button>
      <button class="btn-welcome-alt" id="welcomeSOS">ğŸ†˜ Butuh Bantuan Darurat</button>
    </div>
  </div>

  <div id="toastNotification"></div>

  <script>
    const chargers = [
      { name: "Kelapa Gading", lat: -6.171583, lng: 106.899884, link: "https://maps.app.goo.gl/TKfjDuwrEFU2tHoF9", type: "Fast", nozzles: 3, hours: "24 jam 7/7", cost: "Gratis" },
      { name: "Radio Dalam", lat: -6.257621, lng: 106.802051, link: "https://maps.app.goo.gl/VULRCigqJ4iM8SSZ6", type: "Fast", nozzles: 3, hours: "24 jam 7/7", cost: "Gratis" },
      { name: "Bekasi", lat: -6.223919, lng: 106.010150, link: "https://maps.app.goo.gl/4fdRXFebJHJW63Dg7", type: "Fast", nozzles: 3, hours: "24 jam 7/7", cost: "Gratis (Parkir Berbayar)" },
      { name: "Gading Serpong", lat: -6.246792, lng: 106.629594, link: "https://maps.app.goo.gl/j5oeATswU7J9e9jj7", type: "Fast", nozzles: 3, hours: "24 jam 7/7", cost: "Gratis (Parkir Berbayar)" },
      { name: "Depok", lat: -6.402484, lng: 106.794240, link: "https://maps.app.goo.gl/FYH2yXqo1Mgipz6R7", type: "Fast", nozzles: 3, hours: "24 jam 7/7", cost: "Gratis" },
      { name: "Marbella Kemang", lat: -6.260627, lng: 106.813746, link: "https://maps.app.goo.gl/wwzT9iLS34WFRgyi9", type: "Fast", nozzles: 3, hours: "24 jam 7/7", cost: "Gratis (Parkir berbayar)" },
      { name: "Starvo PIK", lat: -6.124106, lng: 106.739785, link: "https://maps.app.goo.gl/6c5mKecEKvGqjv3Y7", type: "Medium", nozzles: 2, hours: "Seninâ€“Jumat 08.00â€“19.00", cost: 'Berbayar (via Starvo App)' },
      { name: "Starvo Kedoya", lat: -6.186334, lng: 106.766978, link: "https://maps.app.goo.gl/HSKbMPz5UrwW178V9", type: "Medium", nozzles: 1, hours: "09.00â€“17.00", cost: 'Berbayar (via Starvo App)' },
      { name: "Ciledug", lat: -6.207012, lng: 106.714569, link: "https://maps.app.goo.gl/DSJiJyAW1BvL2Gwm8", type: "Fast", nozzles: 2, hours: "24 jam 7/7", cost: "Gratis" },
      { name: "Bintaro", lat: -6.276471, lng: 106.730544, link: "https://maps.app.goo.gl/yZNxoj2gyutxd4zJA", type: "Fast", nozzles: 2, hours: "24 jam 7/7", cost: "Gratis" },
      { name: "Motoriz Meruya", lat: -6.200132, lng: 106.737796, link: "https://maps.app.goo.gl/xLqKRsEZ9WpBpTjf9", type: "Fast", nozzles: 1, hours: "09.00â€“19.00", cost: "Rp. 5.000 / jam" },
      { name: "Motoriz Kranggan", lat: -6.340640, lng: 106.943016, link: "https://maps.app.goo.gl/bA1248oJ5C8pUXhg9", type: "Fast", nozzles: 2, hours: "09.00â€“19.00", cost: 'Berbayar (via Casan.id)' },
      { name: "Warung Bu Ratna Cirendeu", lat: -6.310043, lng: 106.758325, link: "https://maps.app.goo.gl/Eyi3nNZHNMU64iYY7", type: "Fast", nozzles: 2, hours: "06.00â€“23.59", cost: "1k per 10%" },
      { name: "Klinik Pratama Condet", lat: -6.273896, lng: 106.857598, link: "https://maps.app.goo.gl/hTwbD4wEKB8g5qnU8?g_st=ac", type: "Fast", nozzles: 2, hours: "07.00 - Malam", cost: 'Berbayar (via Casan.id)' },
      { name: "Mister Kong Steam Wash", lat: -6.350800, lng: 106.830000, link: "https://maps.app.goo.gl/n6nUVbQzWay6f2MG6", type: "Fast", nozzles: 2, hours: "10.00 - 22.00", cost: 'Berbayar (via Casan.id)' },
      { name: "Hotel Kartika Chandra", lat: -6.227645, lng: 106.819109, link: "https://maps.app.goo.gl/osYqkiaaebUoauxq5", type: "Fast", nozzles: 5, hours: "24 jam", cost: 'Berbayar (via Starvo App)' },
      { name: "Suzuki Cengkareng", lat: -6.150602, lng: 106.727243, link: "https://maps.app.goo.gl/uy6GpcKEHUtQHoFz7?g_st", type: "Fast", nozzles: 2, hours: "24 jam 7/7", cost: 'Berbayar (via Casan.id)' },
      { name: "Dem Pro Kalimalang", lat: -6.244279, lng: 106.902554, link: "https://maps.app.goo.gl/YaQDCmQ2R5u1d4SP8", type: "Fast", nozzles: 2, hours: "24 jam 7/7", cost: 'Berbayar (via Casan.id)' },
      { name: "Trans go Matraman", lat: -6.208155, lng: 106.874669, link: "https://maps.app.goo.gl/dZD5YVGP7NHFJ8bKA", type: "Fast", nozzles: "2", hours: "24 jam", cost: 'Berbayar (via Casan.id)', cp: "6285697279354" },
      { name: "Motoriz Sukapura", lat: -6.139714, lng: 106.922504, link: "https://maps.app.goo.gl/eePUBDDHDBXboHq4A?g_st=ipc", type: "Fast", nozzles: 2, hours: "24 jam", cost: 'Berbayar (via Casan.id)' },
      { name: "Bengkel Bubut Kemayoran", lat: -6.171770, lang: 106.856194,  link: "https://maps.app.goo.gl/ytu5Szsaq5nZGyFR8", type: "Fast", nozzles: 1, hours: "24 jam 7/7", cost: 'Berbayar (via Casan.id)' },
    ];

    let currentList = [...chargers];

    function showToast(message) {
      const toast = document.getElementById('toastNotification');
      toast.textContent = message;
      toast.classList.add('show');
      setTimeout(() => toast.classList.remove('show'), 3000);
    }

    function getDistance(lat1, lon1, lat2, lon2) {
      const R = 6371; 
      const dLat = (lat2 - lat1) * Math.PI / 180;
      const dLon = (lon2 - lon1) * Math.PI / 180;
      const a = Math.sin(dLat/2)**2 + Math.cos(lat1*Math.PI/180)*Math.cos(lat2*Math.PI/180)*Math.sin(dLon/2)**2;
      const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
      return R * c;
    }

    function renderCards(list) {
      const container = document.querySelector('.list-container');
      container.innerHTML = '';
      if (list.length === 0) container.innerHTML = '<div style="text-align:center; padding:40px; opacity:0.6;"><p>Lokasi tidak ditemukan ğŸ¤”</p></div>';
      
      list.forEach((charger, index) => {
        const card = document.createElement('details');
        card.className = 'card';
        card.style.animationDelay = (index * 50) + 'ms'; 
        
        const reportLink = `https://wa.me/6287722285445?text=${encodeURIComponent(`Lapor: ${charger.name} bermasalah.`)}`;
        let cpBtn = charger.cp ? `<a href="https://wa.me/${charger.cp}" target="_blank" class="cp-btn">ğŸ“ CP</a>` : '';

        card.innerHTML = `
          <summary>
            <div style="display:flex; align-items:center;">
                <span>${charger.name}</span>
                ${charger.distance ? `<span class="card-distance">${charger.distance.toFixed(1)} km</span>` : ''}
            </div>
          </summary>
          <div class="card-content">
            <p>âš¡ <strong>Tipe:</strong> ${charger.type} (${charger.nozzles} nozzle)</p>
            <p>ğŸ•’ ${charger.hours}</p>
            <p>ğŸ’µ ${charger.cost}</p>
            <div class="card-actions">
              <a href="${charger.link}" target="_blank" class="nav-link">ğŸ“ Navigasi</a>
              <a href="${reportLink}" target="_blank" class="report-btn">âš ï¸ Lapor</a>
              ${cpBtn}
            </div>
          </div>
        `;
        container.appendChild(card);
      });
    }

    document.addEventListener('DOMContentLoaded', ()=>{
      const findBtn = document.getElementById('manualFindBtn');
      const helpPanel = document.getElementById('helpPanel');
      const floatingSosBtn = document.getElementById('floatingSosBtn');
      const toTopBtn = document.getElementById('toTopBtn');
      
      // SCROLL LOGIC untuk Mengubah Tombol
      window.addEventListener('scroll', () => {
        const scrollY = window.scrollY || document.documentElement.scrollTop;
        
        // Jika scroll lebih dari 100px, munculkan tombol SOS Merah
        if (scrollY > 100) {
          floatingSosBtn.classList.add('show');
          toTopBtn.style.display = 'block';
        } else {
          floatingSosBtn.classList.remove('show');
          toTopBtn.style.display = 'none';
        }
      });

      // Logic Buka Panel Bantuan
      const openHelp = () => {
        helpPanel.style.right = '0px';
        helpPanel.setAttribute('aria-hidden', 'false');
      };
      const closeHelp = () => {
        helpPanel.style.right = '-340px';
      };

      document.getElementById('helpBtnHeader').addEventListener('click', openHelp);
      floatingSosBtn.addEventListener('click', openHelp);
      document.getElementById('closeHelp').addEventListener('click', closeHelp);
      document.getElementById('welcomeSOS').addEventListener('click', ()=>{
        document.getElementById('welcomeOverlay').style.display='none';
        openHelp();
      });

      // Logic Cari Lokasi
      findBtn.addEventListener('click', () => {
        if(!navigator.geolocation) return showToast("GPS tidak didukung");
        findBtn.classList.add('loading'); findBtn.innerHTML = 'â³ Mencari...';
        
        navigator.geolocation.getCurrentPosition(pos => {
          const {latitude: lat, longitude: lng} = pos.coords;
          chargers.forEach(c => c.distance = getDistance(lat, lng, c.lat, c.lng));
          chargers.sort((a, b) => a.distance - b.distance);
          renderCards([...chargers]);
          findBtn.classList.remove('loading'); findBtn.innerHTML = 'âœ… Lokasi Terdekat';
          
          // Auto scroll sedikit ke bawah agar header tidak mengganggu pandangan pertama
          setTimeout(() => { 
             document.querySelector('.list-container').scrollIntoView({behavior: 'smooth', block: 'start'});
             // Buka kartu pertama
             const first = document.querySelector('details');
             if(first) first.open = true;
          }, 300);
        }, () => {
            findBtn.classList.remove('loading'); findBtn.innerHTML = 'ğŸ“ Temukan Lokasi';
            showToast("Gagal ambil lokasi. Cek GPS.");
        });
      });

      // Search Filter
      document.getElementById('searchBox').addEventListener('input', (e)=>{
        const q = e.target.value.toLowerCase();
        const filtered = chargers.filter(c => (c.name+c.cost).toLowerCase().includes(q));
        renderCards(filtered);
      });

      // Welcome
      document.getElementById('welcomeFind').addEventListener('click', ()=>{
        document.getElementById('welcomeOverlay').style.display='none';
        findBtn.click();
      });
      if(!localStorage.getItem('mlu_v3')) document.getElementById('welcomeOverlay').style.display='flex';
      localStorage.setItem('mlu_v3','1');

      toTopBtn.addEventListener('click', () => window.scrollTo({top:0, behavior:'smooth'}));

      renderCards(chargers);
    });
  </script>
</body>
</html>
